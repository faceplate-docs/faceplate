# Руководство пользователя: Архивы и Тренды в Faceplate

## 1. Общие сведения об архивах
В редакторе **Faceplate** подсистема "Архивы" представляет собой инструмент для хранения данных, поступающих из внешних источников (PLC-соединения, IoT-соединения, результаты работы скриптов и т.д.).

Созданные архивы используются инженерами и операторами для анализа, управления и мониторинга производственными процессами на основе исторических данных, представленных в виде графиков и отчетов.

### Характеристики архива
* **Хранение данных:** Сохраняет данные в течение заданного времени для анализа исторических трендов.
* **Сжатие:** Используются методы сжатия для экономии места на диске и оптимизации производительности.
* **Поиск и доступ:** Пользователи могут осуществлять поиск и получать доступ к историческим данным.
* **Защита:** Обеспечение целостности данных и защита от несанкционированных изменений.
* **Цикличность:** Значения параметров архивируются циклически через заданные интервалы времени, вне зависимости от скорости изменения переменной.
* **Развертывание:** Архивы могут быть развернуты локально или удаленно.

---

## 2. Создание и настройка архивов

Редактор “Архивы” позволяет работать с архивируемыми параметрами, производить их настройки, редактировать и удалять созданные ранее. На главной панели редактора отображается база архивов со статусами и источниками.

Создание новых архивов или редактирование существующих выполняется с помощью формы конфигурации.

### Параметры конфигурации

| Параметр | Описание |
| :--- | :--- |
| **Имя** | Уникальное имя архива в рамках проекта. Обычно связано с содержимым (например, "Давление"). Отображается в окне Трендов. |
| **Папка** | Месторасположение архива в структуре проекта. |
| **Отключен** | Переключатель, определяющий, происходит ли запись данных в архив в режиме исполнения. |
| **Глубина (дней)** | Длина хранимой истории. Минимальное значение — 1 день. Изменение параметра влияет на требования к дисковому пространству. |
| **Период (мс)** | Частота записи значений. Уменьшение периода ведет к увеличению нагрузки на ЦПУ и требуемого дискового пространства. |
| **Минимальный шаг** | Система пишет в архив новое значение, только если оно отличается от предыдущего на величину, превышающую или равную этому шагу. Позволяет игнорировать "шум" и снизить нагрузку. |
| **Источник** | Выбор источника данных: `tag` (значение тега), `script` (скрипт) или `iot`. |
| **Тип данных** | • `simple` — основной тип для постоянно меняющихся параметров.<br>• `categorized` — для кодов состояний объекта.<br>• `counter` — разница между предыдущим и текущим значениями. |

---

## 3. Использование скриптов

Источник типа `script` позволяет определить скрипт для дополнительной обработки архивируемого значения или формирования значения на основе нескольких входных параметров.

### Принцип работы
1. Система архивирования считывает значения из полей тегов, к которым привязаны переменные.
2. Выполняется вызов скрипта с передачей на вход карты значений переменных.
3. Возвращаемое из скрипта значение сохраняется в базу архивов.

### Настройка
В редакторе выбирается язык программирования (**Erlang** или **JavaScript**), вводятся переменные и выбирается источник значений для них. Для проверки корректности скрипта используется функция компиляции. Если ошибок нет, выводится соответствующее подтверждение.

---

## 4. Экспорт и Импорт конфигурации

Базу архивируемых параметров можно выгружать в файл формата `.xlsx` и загружать обратно. Это позволяет переносить настройки между проектами (например, с тестового сервера на рабочий) или использовать табличные редакторы для массовых изменений.

### Экспорт
При экспорте формируется файл, где каждая строка соответствует одному архивируемому параметру.

**Основные поля файла конфигурации:**
* Место хранения и имя архива.
* Период архивирования и глубина хранения.
* Состояние (включен/отключен).
* Тип источника и ссылка на тег или скрипт.
* Минимальный шаг и тип данных.

### Импорт
При импорте файла система загружает данные в базу. В случае несогласованности данных (например, отсутствие указанного тега) выводится сообщение об ошибке с указанием номера строки и причины.

---

## 5. Работа с трендами (Runtime)

В режиме исполнения (Runtime) вкладка «Тренды» используется для просмотра графиков параметров, хранящихся в архиве.

### Выбор трендов
Окно выбора состоит из двух вкладок:
1.  **Группы:** Отображает ранее сохраненные наборы трендов для быстрого доступа.
2.  **Архивы:** Позволяет искать параметры и создавать новые графики.

### Настройка серии
Серия — это отдельная линия графика. Для каждой серии можно настроить:
* Цвет и толщину линии.
* Видимость и название.
* Путь к архиву данных.
* Наличие маркеров точек.
* Минимальный и максимальный диапазон отображения.

### Управление отображением
После построения графика пользователь может:
* Задать точный период отображения (дата и время начала/окончания).
* Выбрать предустановленный интервал времени.
* Анализировать поведение параметров на различных временных отрезках.
* При изменении периода график перестраивается автоматически.

---

## 6. Агрегаты

Модуль "Агрегаты" позволяет создавать агрегированные функции для выполнения расчетов непосредственно в трендах.

### Доступные функции
В системе реализованы следующие функции для аналитики:
* **Основные:** Среднее значение, Минимум, Максимум.
* **Интегральные:** Общий интеграл, Интеграл положительных значений, Интеграл отрицательных значений.
* **Статистические:** Стандартное отклонение, Среднее абсолютное значение.
* **Долевые:** Доля положительных значений, Доля отрицательных значений, Доля нулей.
* **Экстремумы:** Минимальное/Максимальное положительное и отрицательное значения.

---

## 7. Элемент "Тренды" (Виджет)

Для разработчиков мнемосхем предусмотрен элемент **Тренды**, который позволяет встроить график в интерфейс оператора.

### Свойства элемента
Разработчик может настроить внешний вид и права доступа оператора через свойства:

* **Сетка (Grid):** Включение отображения и настройка шага сетки по осям времени и значений.
* **Легенда (Legend):** Настройка режима отображения легенды (при наведении, всегда, следовать за курсором или скрыта), а также настройка шрифтов и цветов.
* **Данные (Value):** Привязка к конкретному архиву или группе архивов, настройка периодичности обновления.
* **Шкала (Scale):** Настройка временного шага, фактора периода, а также верхней и нижней границ шкалы.
* **Панель управления (Toolbar):** Управление видимостью панели инструментов в режиме исполнения. Можно выборочно блокировать для оператора функции:
    * Выбор трендов.
    * Задание периода времени.
    * Настройка шкалы.
    * Изменение внешнего вида.
    * Экспорт данных (печать, сохранение в CSV/XML).