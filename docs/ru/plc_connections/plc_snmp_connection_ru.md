# Конфигурация SNMP в Faceplate

## Общее описание
**SNMP** (Simple Network Management Protocol) — это открытый коммуникационный протокол, определенный Инженерным советом интернета (IETF). Протокол широко используется для обмена данными с сетевым оборудованием (контроллеры, шлюзы, ИБП). 

В среде **Faceplate** реализована поддержка протоколов версий **SNMPv2** и **SNMPv3**.

Процесс интеграции состоит из двух этапов:
1.  **Создание соединения (`plc_snmp_connection`):** Настройка сетевого транспорта и логики резервирования.
2.  **Создание привязок (`plc_snmp_binding`):** Адресация конкретных переменных (OID) внутри устройства.

---

## ШАГ 1. Настройка соединения (Connection)

На этом этапе создается транспортный канал до оборудования.

![Окно настройки соединения](images/snmp_connections.png)

### 1.1 Панель диагностики (Runtime)
*Верхняя часть окна. Отображает текущее состояние процесса.*

| Поле | Описание |
| :--- | :--- |
| **State** | **STOP** (Красный) — драйвер остановлен.<br>**RUN** (Зеленый) — драйвер запущен. |
| **Error** | Текст последней ошибки. `no errors` — штатная работа. |
| **Actual connection** | **Индикатор активного канала.**<br>Показывает, какое именно соединение используется для опроса в данный момент.<br>• Если резервирование не настроено — совпадает с текущим.<br>• При резервировании показывает, активен ли сейчас `Master` или текущий резервный канал. |

### 1.2 Параметры конфигурации (Settings)

**Основные настройки:**
* **Name:** Уникальное системное имя (латиница, без пробелов).
* **Period (ms):** Частота опроса (стандарт: `1000` мс).
* **Shutdown timeout (ms):** Время на корректное закрытие сокета (стандарт: `60000`).

**Настройка резервирования (Redundancy):**
* **Master connection:** Ссылка на "главное" соединение.
    * *Используется для создания резервного канала.* Если текущее соединение является резервным, здесь указывается имя основного соединения. Система будет автоматически переключаться между ними в зависимости от доступности.

**Сетевые настройки:**
* **IP/Hostname:** IP-адрес целевого устройства.
* **Port:** `161` (стандартный UDP порт агента).
* **Community:** Пароль доступа. Обычно `public` (только чтение) или `private` (запись).
* **Support for group requests:** `Yes` — включить `GetBulk` (пакетное чтение). Рекомендуется для ускорения опроса, если устройство поддерживает эту функцию.

> **Действие:** Нажмите **Save**. После сохранения перейдите внутрь объекта (double click) для настройки тегов.

---

## ШАГ 2. Настройка переменных (Binding)

Внутри соединения создаются объекты `plc_snmp_binding`. Каждый объект соответствует одной переменной (OID) на устройстве.

![Окно настройки привязки](images/snmp_bindings.png)

### 2.1 Параметры привязки

| Поле | Описание |
| :--- | :--- |
| **Name** | Имя привязки в дереве проекта. |
| **Tag** | Выбор системного тега Faceplate, в который будет записываться значение. |
| **Transformation** | *Опционально.* Преобразование данных "на лету" (масштабирование, битовые маски). |
| **Access** | Права доступа к переменной:<br>• **R** — Read (Только чтение).<br>• **W** — Write (Только запись).<br>• **RW** — Read/Write (Чтение и запись). |
| **Address** | **OID (Object Identifier).** Адрес переменной в иерархии SNMP.<br>*Примеры:* `1.3.6.1.2.1.1.1.0` (абсолютный) или `1.6.3.1` (относительный, если поддерживается). |

### 2.2 Управление (Runtime)
* **State:** Текущее состояние привязки (активна/ошибка).
* **Off:** Переключатель для временного отключения опроса конкретного тега без удаления настройки.

---

<!-- ## Дополнительно

1.  **Резервирование:** Если вы настраиваете резервный канал, убедитесь, что в поле `Master connection` указано корректное имя основного соединения. Поле `Actual connection` в Runtime подскажет, какой канал сейчас "ведет" опрос.
2.  **OID:** При ошибках `No Such Name` проверьте поле **Address**. Рекомендуется использовать сторонний MIB Browser для валидации OID перед настройкой.
3.  **Порядок запуска:**
    1. Настроить Connection.
    2. Запустить драйвер (`State: RUN`).
    3. Убедиться, что нет ошибок связи.
    4. Создавать Binding. -->