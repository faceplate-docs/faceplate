# Конфигурация DCON (ICP DAS) в Faceplate

## Общее описание
**DCON** — это промышленный протокол на базе ASCII, разработанный компанией ICP DAS. Используется для опроса модулей ввода-вывода (серии I-7000, M-7000) и преобразователей.

Драйвер DCON в системе **Faceplate** является мульти-транспортным. Он позволяет организовать связь двумя способами:
1.  **TCP (Ethernet):** Работа через сетевые шлюзы (например, Moxa NPort, tDS-700) или с модулями, имеющими встроенный Ethernet.
2.  **Serial (COM):** Прямое подключение к серверу через RS-485 порт или USB-конвертер.

Процесс настройки состоит из двух этапов:
1.  **Connection:** Настройка физического транспорта.
2.  **Binding:** Адресация логического устройства и канала.

---

## ШАГ 1. Настройка соединения (`plc_dcon_connection`)

На этом этапе задаются параметры "трубы", через которую пойдет обмен данными. Набор полей меняется в зависимости от выбранного **Type**.

### 1.1 Панель диагностики (Runtime)
*Служит для мониторинга состояния процесса в реальном времени.*

![Диагностика DCON](images/dcon_connection.png)

| Поле | Описание |
| :--- | :--- |
| **State** | **STOP** (Красный) — драйвер остановлен.<br>**RUN** (Зеленый) — опрос идет. |
| **Error** | Текст последней ошибки (например, `Port busy` или `Timeout`). |
| **Node / PID** | Узел кластера и ID процесса в ОС (полезно для отладки блокировок COM-портов). |
| **Actual connection** | При резервировании показывает активный канал (Master или Backup). |

### 1.2 Общие настройки (Settings)
*Эти параметры актуальны для любого типа связи.*

| Параметр | Описание |
| :--- | :--- |
| **Name** | Уникальное имя соединения. |
| **Period (ms)** | Частота опроса. *Рекомендация:* Для Serial/RS-485 ставьте >500 мс во избежание коллизий. |
| **Type** | **Переключатель режима транспорта:**<br>• `tcp` — Сетевое соединение.<br>• `serial` — Прямое подключение через COM-порт. |
| **Master connection** | Ссылка на основное соединение (только для настройки резервного канала). |

---

### 1.3 Настройка транспорта (В зависимости от Type)

#### Вариант А: Режим `serial` (Прямое подключение)
Используется, если гирлянда модулей подключена физически к серверу.

![Настройка Serial](images/dcon_serial.png)

| Поле | Описание |
| :--- | :--- |
| **Port** | Системный путь к порту.<br>• Linux: `/dev/ttyS0`, `/dev/ttyUSB0`<br>• Windows: `COM1`, `COM3` |
| **Baud rate** | Скорость передачи (Стандарт DCON: `9600`). Должна совпадать с настройками модулей. |
| **Parity** | Четность (Обычно `no`). |
| **Stop bits** | Стоповые биты (Обычно `1`). |
| **Data bits** | Биты данных (Обычно `8`). |

#### Вариант Б: Режим `tcp` (Сетевой шлюз)
Используется, если модули находятся удаленно за преобразователем Ethernet-to-RS485.

![Настройка TCP](image_25dde7.png)

| Поле | Описание |
| :--- | :--- |
| **IP/Hostname** | IP-адрес шлюза или модуля. |
| **Port** | TCP порт шлюза (часто `502`, `4001` или `1024`). |
| **Timeout** | Время ожидания ответа по сети. |

> **Действие:** Нажмите **Save**, затем перейдите внутрь соединения (Double Click) для создания привязок.

---

## ШАГ 2. Настройка переменных (`plc_dcon_binding`)

Настройка конкретных точек данных. Один объект Binding = Один канал модуля.

![Настройка Binding](images/dcon_bindings.png)

### 2.1 Параметры адресации

| Поле | Описание |
| :--- | :--- |
| **Name** | Имя привязки. |
| **Tag** | Системный тег для хранения значения. |
| **Access** | **R** (Чтение), **W** (Запись). |
| **Address** | **NetID (Сетевой адрес).** Выставляется DIP-переключателями на корпусе модуля (0-255). |

### 2.2 Конфигурация модуля (Module Settings)
*Описывает физические возможности "железки".*
* **DI / DO / AI / AO:** Укажите количество каналов соответствующего типа на модуле.
    * *Пример:* Для I-7017 (8 AI) ставим `AI: 8`, остальные `0`.

### 2.3 Конфигурация канала (Channel Settings)
*Выбирает конкретный "пин".*
* **Type:** Тип данных (например, Analog Input).
* **Channel:** Номер канала (нумерация с 0).
* **Format:** Формат данных (`HEX` — шестнадцатеричный, `Dec` — десятичный). Важно для парсинга ответа.

---
<!-- 
## Дополнительно

1.  **Доступ к порту (Linux/Serial):** Если при `Type: serial` возникает ошибка доступа, убедитесь, что пользователь, от которого запущен сервис Faceplate, состоит в группе `dialout` (или `uucp`).
2.  **Скорость (Baud Rate):** DCON не поддерживает автосогласование. Скорость в настройках соединения должна **строго** совпадать со скоростью всех модулей на линии.
3.  **Режим шлюза (TCP):** Если используете NPort или аналоги, убедитесь, что он настроен в режиме **TCP Server**, а параметры RS-485 (скорость, четность) внутри шлюза совпадают с модулями.
4.  **Адресация:** Убедитесь, что в поле `Address` указан верный ID. Если ID неверен, ответа не будет (протокол "запрос-ответ"). -->