# Руководство по конфигурации OPC UA Client

## Общее описание
**OPC UA (Unified Architecture)** — это современный кроссплатформенный стандарт промышленной связи (IEC 62541). В отличие от классического OPC DA, он не зависит от Windows/DCOM, поддерживает шифрование и сложные структуры данных.

Драйвер **OPC UA Client** в системе **Faceplate** позволяет подключаться к серверам (ПЛК Siemens S7-1500, Kepware, Prosys, B&R и др.) по бинарному протоколу `opc.tcp`.

Процесс настройки состоит из двух этапов:
1.  **Connection (`plc_opcua_client_connection`):** Настройка эндпоинта (Endpoint), безопасности и аутентификации.
2.  **Binding (`plc_opcua_client_binding`):** Подписка на конкретные узлы (Nodes).

---

##  1. Настройка соединения (Connection)
> Создать PLC cоединения → [Шаги создания PLC соединения](./general_ru.md#создание-plc-соединения)
Здесь мы создаем защищенный канал связи с сервером.

![Настройка соединения OPC UA](images/opcua_client.png)

### 1.1 Панель диагностики
>Диагностика PLC соединения → [Диагностика](./general_ru.md#диагностика-diagnostics)

| Поле | Описание |
| :--- | :--- |
| **State** | **STOP** — драйвер остановлен.<br>**RUN** — драйвер запущен. |
| **Node** | Узел кластера. Указывает, на каком узле выполняется процесс. |
| **PID** | ID процесса. |
| **Error** | Текст ошибки (при наличии). |
| **Disabled** | Флаг отключения соединения. Через данную кнопку пользователь отключает или включает драйвер.|
| **Memory limit (bytes)** | Ограничение памяти (пределы оперативной памяти в байтах для процесса, обслуживающего соединение). Емкость памяти определяет количество переменных (тегов), которые могут быть обработаны. |
| **Actual connection** | Текущий активный канал связи. В системах с резервированием (Redundancy) указывает, какое именно соединение (основное или резервное) осуществляет обмен данными в текущий момент. |
| **Master connection** | Привязка к основному каналу связи. Заполняется для резервных соединений. Поле указывает, какое соединение является приоритетным (Master), определяя логическую пару для механизма резервирования. |


### 1.2 Основные параметры (Settings)
| Параметр | Описание |
| :--- | :--- |
| **Name** | Уникальное имя соединения. |
| **Title** | Заголовок (описание) данного объекта. |
| **Period (ms)** | Базовый цикл обработки драйвера. |
| **Shutdown timeout (ms)** | Время ожидания завершения операций при остановке драйвера. |
| **Support for group requests** *| **Yes** — включить поддержку общего опроса (General Interrogation). |
| **Max. package length** *| Максимальный размер пакета. Обычно 250 байт. |
| **Line Delay Ratio** *| Коэффициент задержки линии. |


### 1.3 Параметры Протокола (OPC UA client)
Самая важная часть настройки OPC UA.

| Поле | Описание и аналитика |
| :--- | :--- |
| **URL** | **Endpoint URL.** Адрес сервера.<br>*Формат:* `opc.tcp://<IP-address>:<Port>`<br>*Пример:* `opc.tcp://192.168.0.10:4840` |
| **MaxNodesPerBrowse** | Ограничение количества узлов при просмотре дерева адресов (Browse). Стандарт: `1000`. |
| **Timeout** | Время ожидания ответа от сервера (мс). |
| **Secure connection** | **Режим шифрования.**<br>• **No (Выкл):** Режим `None` (без безопасности). Подходит для тестов.<br>• **Yes (Вкл):** Использование `Sign` или `SignAndEncrypt`. Требует наличия сертификатов. |
| **Certificate / Key** | Пути к файлам публичного сертификата (`.der`) и приватного ключа (`.pem`) клиента. |
| **Generate a certificate** | Кнопка для автоматической генерации самоподписанного сертификата клиента. |
| **Login / Password** | **Аутентификация пользователя.**<br>• Если пусто — используется **Anonymous**.<br>• Если заполнено — используется **User/Password** токен. |

---

##  2. Настройка переменных (Binding)

В OPC UA адресация осуществляется по **NodeId** (Идентификатор узла).

![Настройка привязки OPC UA](images/opcua_client_bindings.png)
> Создать PLC привязку → [Шаги создания PLC привязки](./general_ru.md#создание-plc-привязки)
> 
### 2.1 Параметры привязки
| Поле | Описание |
| :--- | :--- |
| **Name** | Имя привязки. |
| **Title** | Заголовок (описание) для данного объекта. |
| **State** | **STOP** — привязка остановлена.<br>**RUN** — привязка запущен. |
| **Tag** | Системный тег Faceplate. Приходящее значение будет записано в выбранное поле выбранного объекта. Cм. [Привязка к тегу](./general_ru.md#привязка-к-тегу-на-примере-архива) |
| **Transformation** | Преобразование значения. См. [Transformation](./transformation_ru.md). |
| **Access** | **R** (Чтение), **W** (Запись), **RW** (Чтение/Запись). |

### 2.2 Адресация узла (OPC UA Node)

| Поле | Инструкция |
| :--- | :--- |
| **OPC tag** | **NodeId (Адрес узла).**<br>Уникальный адрес переменной на сервере. Состоит из индекса пространства имен (ns) и идентификатора (s, i, g, b).<br>*Примеры:*<br>• `ns=2;s=Machine1.Sensor.Temp` (Строковый ID)<br>• `ns=3;i=1005` (Числовой ID)<br>• `i=2258` (Стандартный узел, ns=0) |
| **Type** | Тип данных OPC UA (Int32, Float, Boolean, String и т.д.). Обычно определяется автоматически, но можно задать жестко. |

>Ошибка в PLC привязке -> [ошибка привязки](./general_ru.md#ошибка-в-привязке)

---

