
# üìò –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Modbus (TCP/RTU)

## –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
**Modbus** ‚Äî —ç—Ç–æ –¥–µ-—Ñ–∞–∫—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏. –í —Å–∏—Å—Ç–µ–º–µ **Faceplate** —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π —Ç—Ä–∏ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–∞—à–∏–≤–∞—Ç—å –∫–∞–∫ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, —Ç–∞–∫ –∏ —É—Å—Ç–∞—Ä–µ–≤—à–µ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –¥–∞—Ç—á–∏–∫–∏ —á–µ—Ä–µ–∑ —à–ª—é–∑—ã.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ä–µ–∂–∏–º—ã (`Type`):
1.  **tcp:** –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π Modbus TCP (Ethernet).
2.  **rtu-serial:** Modbus RTU —á–µ—Ä–µ–∑ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π COM-–ø–æ—Ä—Ç (RS-485/232).
3.  **rtu-tcp:** Modbus RTU –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤ TCP –ø–∞–∫–µ—Ç (Modbus-over-TCP). –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º–∏ —à–ª—é–∑–∞–º–∏ (Moxa, HF –∏ –¥—Ä.).

–ü—Ä–æ—Ü–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —ç—Ç–∞–ø–æ–≤:
1.  **Connection (`plc_modbus_connection`):** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞.
2.  **Binding (`plc_modbus_binding`):** –ê–¥—Ä–µ—Å–∞—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤.

---

## –®–ê–ì 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (Connection)

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –º—ã –≤—ã–±–∏—Ä–∞–µ–º —Ñ–∏–∑–∏–∫—É —Å–≤—è–∑–∏.

### 1.1 –í—ã–±–æ—Ä —Ç–∏–ø–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
–ü–µ—Ä–≤—ã–º –¥–µ–ª–æ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ç–∏–ø –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ –ø–æ–ª–µ **Type**.

![–í—ã–±–æ—Ä —Ç–∏–ø–∞ Modbus](images/modbus_type.png)

### 1.2 –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–û–±—â–∏–µ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ |
| :--- | :--- |
| **Name** | –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. |
| **Period (ms)** | –ü–µ—Ä–∏–æ–¥ –æ–ø—Ä–æ—Å–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `1000`). <br>*–°–æ–≤–µ—Ç:* –î–ª—è Serial —Å—Ç–∞–≤—å—Ç–µ >100-200 –º—Å. –î–ª—è TCP –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ. |
| **Shutdown timeout** | –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–æ–∫–µ—Ç–∞ (`60000`). |
| **Support for group requests** | **Yes** ‚Äî –≤–∫–ª—é—á–∏—Ç—å –≥—Ä—É–ø–ø–æ–≤–æ–µ —á—Ç–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è). –î—Ä–∞–π–≤–µ—Ä –±—É–¥–µ—Ç —á–∏—Ç–∞—Ç—å –ø–æ–¥—Ä—è–¥ –∏–¥—É—â–∏–µ –∞–¥—Ä–µ—Å–∞ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º. |
| **Max. package length** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã PDU. –ï—Å–ª–∏ —à–ª—é–∑ –∏–º–µ–µ—Ç –º–∞–ª—ã–π –±—É—Ñ–µ—Ä, —É–º–µ–Ω—å—à–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç 250). |

---

### 1.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è

#### –í–∞—Ä–∏–∞–Ω—Ç –ê: –†–µ–∂–∏–º `tcp` (Ethernet)
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–≤—è–∑–∏ —Å –ü–õ–ö –∏–ª–∏ –º–æ–¥—É–ª—è–º–∏ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞, –∏–º–µ—é—â–∏–º–∏ Ethernet-–ø–æ—Ä—Ç –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–º–∏ —Å—Ç–µ–∫ Modbus TCP.

![–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Modbus TCP](images/tcp.png)

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| **IP/Hostname** | IP-–∞–¥—Ä–µ—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `192.168.1.10`). |
| **Port** | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç Modbus TCP ‚Äî **502**. |
| **Timeout** | –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ (–≤ –º—Å). |
| **Attempts** | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–¥ –æ—à–∏–±–∫–æ–π —Å–≤—è–∑–∏. |

#### –í–∞—Ä–∏–∞–Ω—Ç –ë: –†–µ–∂–∏–º `rtu-serial` (RS-485/232)
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≥–∏—Ä–ª—è–Ω–¥—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∫ COM-–ø–æ—Ä—Ç—É —Å–µ—Ä–≤–µ—Ä–∞.

![–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Modbus RTU Serial](images/rtu_serial.png)

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| **Port** | –ü—É—Ç—å –∫ –ø–æ—Ä—Ç—É (Linux: `/dev/ttyUSB0`, Windows: `COM1`). |
| **Baud rate** | –°–∫–æ—Ä–æ—Å—Ç—å. –î–æ–ª–∂–Ω–∞ —Å—Ç—Ä–æ–≥–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –ª–∏–Ω–∏–∏ (9600, 19200 –∏ —Ç.–¥.). |
| **Parity** | –ß–µ—Ç–Ω–æ—Å—Ç—å (`no`, `even`, `odd`). |
| **Stop bits / Data bits** | –û–±—ã—á–Ω–æ `1` –∏ `8`. |
| **Line Delay Ratio** | –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –ª–∏–Ω–∏–∏. –£–≤–µ–ª–∏—á—å—Ç–µ, –µ—Å–ª–∏ –ª–∏–Ω–∏—è –¥–ª–∏–Ω–Ω–∞—è –∏ "—à—É–º–Ω–∞—è". |

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –†–µ–∂–∏–º **rtu-tcp** –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Ä–µ–∂–∏–º—É TCP (–Ω—É–∂–µ–Ω IP –∏ –ü–æ—Ä—Ç), –Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–∞ –≤–Ω—É—Ç—Ä–∏ –±—É–¥–µ—Ç –∫–∞–∫ —É RTU (—Å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º–æ–π CRC).

---

## –®–ê–ì 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (Binding)

–ó–¥–µ—Å—å –º—ã –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ–≥–∏—Å—Ç—Ä Modbus –∫ —Ç–µ–≥—É —Å–∏—Å—Ç–µ–º—ã.

![–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Binding Modbus](images/bindings.png)

### 2.1 –ê–¥—Ä–µ—Å–∞—Ü–∏—è (Addressing)

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| **Slave address** | –ê–¥—Ä–µ—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (Unit ID). –í TCP –æ–±—ã—á–Ω–æ `1` (–∏–ª–∏ `255`), –≤ Serial ‚Äî –æ—Ç `1` –¥–æ `247`. |
| **Memory area** | –¢–∏–ø –ø–∞–º—è—Ç–∏ Modbus:<br>‚Ä¢ **HR** (Holding Registers) ‚Äî 4xxxx, —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å.<br>‚Ä¢ **IR** (Input Registers) ‚Äî 3xxxx, —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ.<br>‚Ä¢ **CS** (Coils) ‚Äî 0xxxx, –±–∏—Ç—ã —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å.<br>‚Ä¢ **IS** (Discrete Inputs) ‚Äî 1xxxx, –±–∏—Ç—ã —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ. |
| **Address** | –°–º–µ—â–µ–Ω–∏–µ (Offset) –∞–¥—Ä–µ—Å–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞. <br>*–í–Ω–∏–º–∞–Ω–∏–µ:* –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–∞—Ä—Ç–∞—Ö –∞–¥—Ä–µ—Å–æ–≤ –Ω—É–º–µ—Ä–∞—Ü–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 1, –≤ –¥—Ä–∞–π–≤–µ—Ä–µ –æ–±—ã—á–Ω–æ —Å 0. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ "—Å–¥–≤–∏–Ω—É—Ç—ã", –ø–æ–ø—Ä–æ–±—É–π—Ç–µ +/- 1. |
| **Read / Write** | –ö–æ–¥—ã —Ñ—É–Ω–∫—Ü–∏–π Modbus. –û–±—ã—á–Ω–æ –≤—ã—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ Memory Area (–Ω–∞–ø—Ä–∏–º–µ—Ä, Read `03`, Write `10` –∏–ª–∏ `06`). |

### 2.2 –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö (Data Handling)

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| **The size** | –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö (Word = 16 –±–∏—Ç, DWord = 32 –±–∏—Ç–∞ –∏ —Ç.–¥.). |
| **Format** | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö: `signed-integer` (—Å–æ –∑–Ω–∞–∫–æ–º), `unsigned`, `float` (–≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ). |
| **Byte order** | **–ü–æ—Ä—è–¥–æ–∫ –±–∞–π—Ç.** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞.<br>‚Ä¢ `21` ‚Äî Big Endian (—Å—Ç–∞–Ω–¥–∞—Ä—Ç).<br>‚Ä¢ `12` ‚Äî Little Endian.<br>‚Ä¢ `2143` / `3412` ‚Äî –†–∞–∑–ª–∏—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã Swap –¥–ª—è 32-–±–∏—Ç–Ω—ã—Ö —á–∏—Å–µ–ª. –ü–æ–¥–±–∏—Ä–∞–µ—Ç—Å—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ, –µ—Å–ª–∏ —á–∏—Å–ª–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–µ–≤–µ—Ä–Ω–æ. |
| **Check CRC** | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã (–æ–±—ã—á–Ω–æ `Yes`). |

---

## üí° –ß–µ–∫-–ª–∏—Å—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

1.  **–°–¥–≤–∏–≥ –∞–¥—Ä–µ—Å–∞:** –°–∞–º–∞—è —á–∞—Å—Ç–∞—è –ø—Ä–æ–±–ª–µ–º–∞ Modbus. –ï—Å–ª–∏ –≤—ã –æ–∂–∏–¥–∞–µ—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ `100`, –∞ –≤–∏–¥–∏—Ç–µ `0`, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∞–¥—Ä–µ—Å `99` –∏–ª–∏ `101`.
2.  **–ü–æ—Ä—è–¥–æ–∫ –±–∞–π—Ç (Endianness):** –ï—Å–ª–∏ –≤–º–µ—Å—Ç–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã `25.0` –≤—ã –≤–∏–¥–∏—Ç–µ –æ–≥—Ä–æ–º–Ω–æ–µ —á–∏—Å–ª–æ –∏–ª–∏ `0.0004` ‚Äî –º–µ–Ω—è–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É **Byte order**.
3.  **–¢–∞–π–º–∞—É—Ç—ã:** –î–ª—è RTU Serial –≤—Å–µ–≥–¥–∞ —Å—Ç–∞–≤—å—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã —Å –∑–∞–ø–∞—Å–æ–º (–º–∏–Ω–∏–º—É–º 100-200 –º—Å), —Ç–∞–∫ –∫–∞–∫ RS-485 ‚Äî –ø–æ–ª—É–¥—É–ø–ª–µ–∫—Å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
4.  **IP-–∞–¥—Ä–µ—Å–∞—Ü–∏—è:** –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `rtu-tcp` (—à–ª—é–∑–æ–≤) —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ **Slave Address** —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∞–¥—Ä–µ—Å—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ù–ê –®–ò–ù–ï RS-485 –∑–∞ —à–ª—é–∑–æ–º, –∞ –Ω–µ IP-–∞–¥—Ä–µ—Å—É —Å–∞–º–æ–≥–æ —à–ª—é–∑–∞.