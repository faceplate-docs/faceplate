# üìò –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Siemens S7 (ISO-on-TCP)

## –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
–î—Ä–∞–π–≤–µ—Ä **S7** –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ —Å –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–µ–º—ã–º–∏ –ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º–∏ (–ü–õ–ö) –∫–æ–º–ø–∞–Ω–∏–∏ Siemens —Å–µ–º–µ–π—Å—Ç–≤–∞ **Simatic S7**.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–µ—Ä–∏–∏:
* **S7-300 / S7-400** (–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞).
* **S7-1200 / S7-1500** (–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Ä–∏–∏, —Ç—Ä–µ–±—É—é—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞, —Å–º. —Ä–∞–∑–¥–µ–ª Troubleshooting).
* **Siemens Logo!** (–Ω–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–π 0BA7/0BA8).

–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É **ISO-on-TCP** (RFC 1006) —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç **102**.

–ü—Ä–æ—Ü–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —ç—Ç–∞–ø–æ–≤:
1.  **Connection (`plc_s7_connection`):** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ CPU.
2.  **Binding (`plc_s7_binding`):** –ê–¥—Ä–µ—Å–∞—Ü–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —è—á–µ–π–∫–∏ –ø–∞–º—è—Ç–∏.

---

## –®–ê–ì 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (Connection)

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –º—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω–æ–º—É –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—É –∏–ª–∏ –ø–æ—Ä—Ç—É Ethernet –Ω–∞ CPU.

### 1.1 –ü–∞–Ω–µ–ª—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ (Runtime)
*–í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å –æ–∫–Ω–∞. –°–ª—É–∂–∏—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è.*

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| **State** | **STOP** (–ö—Ä–∞—Å–Ω—ã–π) ‚Äî –¥—Ä–∞–π–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.<br>**RUN** (–ó–µ–ª–µ–Ω—ã–π) ‚Äî —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ (Handshake –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ). |
| **Error** | –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏. <br>*–ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏:* `Connection refused` (–Ω–µ—Ç —Å–≤—è–∑–∏/–Ω–µ–≤–µ—Ä–Ω—ã–π –ø–æ—Ä—Ç), `Iso packet error` (–Ω–µ–≤–µ—Ä–Ω—ã–π Rack/Slot). |
| **Actual connection** | –¢–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π –∫–∞–Ω–∞–ª (–ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è). |

### 1.2 –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (Settings)

![–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è S7](images/s7_conn.png)

#### –û—Å–Ω–æ–≤–Ω—ã–µ –∏ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| **Name** | –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. |
| **Period (ms)** | –ü–µ—Ä–∏–æ–¥ –æ–ø—Ä–æ—Å–∞. –°—Ç–∞–Ω–¥–∞—Ä—Ç `1000`. S7comm –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—ã—Å—Ç—Ä—ã–π, –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á –º–æ–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å `100-200` –º—Å. |
| **Master connection** | –°—Å—ã–ª–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–¥–ª—è —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è). |
| **Support for group requests** | **Yes** ‚Äî –¥—Ä–∞–π–≤–µ—Ä –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ "—Å–∫–ª–µ–∏–≤–∞—Ç—å" –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–æ—Å–µ–¥–Ω–∏–º –±–∞–π—Ç–∞–º –≤ –æ–¥–∏–Ω –ø–∞–∫–µ—Ç PDU (Optimization). |
| **Max. package length** | –†–∞–∑–º–µ—Ä PDU (Protocol Data Unit). –û–±—ã—á–Ω–æ `240` –∏–ª–∏ `480` –±–∞–π—Ç –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —Å–µ—Ä–∏–π, `960` –¥–ª—è –Ω–æ–≤—ã—Ö. |

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ (S7 / TCP)
–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∞–¥—Ä–µ—Å–∞—Ü–∏–∏ "–∂–µ–ª–µ–∑–∞".

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ |
| :--- | :--- |
| **Data type** | –¢–∏–ø (—Å–µ–º–µ–π—Å—Ç–≤–æ) –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞. <br>–í–ª–∏—è–µ—Ç –Ω–∞ –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤. –í—ã–±–µ—Ä–∏—Ç–µ `300` (–¥–ª—è S7-300/400/VIPA) –∏–ª–∏ `1200`/`1500` –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ç–∞–∫–∏—Ö –æ–ø—Ü–∏–π. |
| **IP/Hostname** | IP-–∞–¥—Ä–µ—Å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞. |
| **Port** | **102** (–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç Siemens ISO-on-TCP). |
| **Rack** | **–ù–æ–º–µ—Ä –∫–æ—Ä–∑–∏–Ω—ã (—à–∞—Å—Å–∏).** <br>‚Ä¢ –î–ª—è S7-300/400/1500: –û–±—ã—á–Ω–æ `0`. |
| **Slot** | **–ù–æ–º–µ—Ä —Å–ª–æ—Ç–∞ CPU.** (–ü–æ–ª–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∏–∂–µ Rack).<br>‚ö†Ô∏è **–≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä:**<br>‚Ä¢ **S7-300:** –í—Å–µ–≥–¥–∞ `2`.<br>‚Ä¢ **S7-400:** –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Hardware (—á–∞—Å—Ç–æ `2` –∏–ª–∏ `3`).<br>‚Ä¢ **S7-1200 / S7-1500:** –û–±—ã—á–Ω–æ `1` (–∏–ª–∏ `0` –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ—à–∏–≤–æ–∫ 1200). |

---

## –®–ê–ì 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (Binding)

–í S7 –ø–∞–º—è—Ç—å –∏–º–µ–µ—Ç –∂–µ—Å—Ç–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É. –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –µ—ë –æ–±–ª–∞—Å—Ç—å, —Ç–∏–ø –∏ —Å–º–µ—â–µ–Ω–∏–µ (–∞–¥—Ä–µ—Å).

![–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–≤—è–∑–∫–∏ S7](images/s7_bind.png)

### 2.1 –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏–≤—è–∑–∫–∏

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| **Name** | –ò–º—è –ø—Ä–∏–≤—è–∑–∫–∏. |
| **Tag** | –°–∏—Å—Ç–µ–º–Ω—ã–π —Ç–µ–≥ Faceplate. |
| **Access** | **R** (Read), **W** (Write). |

### 2.2 –ê–¥—Ä–µ—Å–∞—Ü–∏—è –ø–∞–º—è—Ç–∏ (S7 Address)

–î–ª—è –∞–¥—Ä–µ—Å–∞—Ü–∏–∏ –≤–∏–¥–∞ `DB1.DBX10.2` (–ë–∏—Ç 2 –≤ –±–∞–π—Ç–µ 10 –±–ª–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö 1) –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥—É—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

| –ü–æ–ª–µ | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è |
| :--- | :--- |
| **Memory area** | –û–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏:<br>‚Ä¢ **DB** ‚Äî Data Block (–ë–ª–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –æ—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å).<br>‚Ä¢ **I** (Inputs) ‚Äî –í—Ö–æ–¥—ã.<br>‚Ä¢ **Q** (Outputs) ‚Äî –í—ã—Ö–æ–¥—ã.<br>‚Ä¢ **M** (Flags/Merkers) ‚Äî –ú–µ—Ä–∫–µ—Ä–Ω–∞—è –ø–∞–º—è—Ç—å. |
| **Type** | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π:<br>‚Ä¢ `bit` (BOOL)<br>‚Ä¢ `byte`, `word`, `dword`<br>‚Ä¢ `int`, `real` (float) |
| **DB** | **–ù–æ–º–µ—Ä –±–ª–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö.** –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `Memory area` = **DB**. (–ù–∞–ø—Ä–∏–º–µ—Ä, `1`). |
| **Byte** | **–°–º–µ—â–µ–Ω–∏–µ –±–∞–π—Ç–∞ (Byte Offset).** –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–π—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π. |
| **Bit** | **–°–º–µ—â–µ–Ω–∏–µ –±–∏—Ç–∞ (Bit Offset).** –û—Ç `0` –¥–æ `7`. <br>–ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ** –µ—Å–ª–∏ `Type` = `bit`. –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `0`. |
| **Format** | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `integer` –¥–ª—è –∑–Ω–∞–∫–æ–≤—ã—Ö —á–∏—Å–µ–ª –∏–ª–∏ `float` –¥–ª—è –≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö). |

---

## üí° –ß–µ–∫-–ª–∏—Å—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (Troubleshooting)

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å S7-1200 –∏ S7-1500 —á–∞—Å—Ç–æ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã –¥–æ—Å—Ç—É–ø–∞. –ï—Å–ª–∏ `Error` –ø–∏—à–µ—Ç "Permission denied" –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∏–¥—É—Ç:

1.  **Optimized Block Access:**
    * –î—Ä–∞–π–≤–µ—Ä—ã —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ (S7comm) –æ–±—ã—á–Ω–æ **–Ω–µ —É–º–µ—é—Ç** —Ä–∞–±–æ—Ç–∞—Ç—å —Å "–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –±–ª–æ–∫–∞–º–∏" (—Å–∏–º–≤–æ–ª—å–Ω–∞—è –∞–¥—Ä–µ—Å–∞—Ü–∏—è).
    * *–†–µ—à–µ–Ω–∏–µ:* –í TIA Portal –æ—Ç–∫—Ä–æ–π—Ç–µ —Å–≤–æ–π—Å—Ç–≤–∞ DB –∏ **—Å–Ω–∏–º–∏—Ç–µ** –≥–∞–ª–æ—á–∫—É "Optimized block access". –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –≤ –ü–õ–ö.
2.  **PUT/GET Access:**
    * –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö CPU (–≤ TIA Portal) –≤ —Ä–∞–∑–¥–µ–ª–µ *Protection & Security -> Connection mechanisms* –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞** –≥–∞–ª–æ—á–∫–∞: *"Permit access with PUT/GET communication from remote partner"*.
3.  **Rack/Slot:**
    * –ï—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ S7-300: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Rack=`0`, Slot=`2`.
    * –ï—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ S7-1200: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Rack=`0`, Slot=`1`.