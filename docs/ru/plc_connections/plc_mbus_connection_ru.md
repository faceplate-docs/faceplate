# üìò –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥—Ä–∞–π–≤–µ—Ä–∞ M-Bus (Meter-Bus)

## –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
**M-Bus (Meter-Bus)** ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –µ–≤—Ä–æ–ø–µ–π—Å–∫–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç (EN 13757) –¥–ª—è –¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–∏–±–æ—Ä–æ–≤ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–≥–æ —É—á–µ—Ç–∞: —Ç–µ–ø–ª–æ—Å—á–µ—Ç—á–∏–∫–æ–≤, –≤–æ–¥–æ—Å—á–µ—Ç—á–∏–∫–æ–≤, —Å—á–µ—Ç—á–∏–∫–æ–≤ –≥–∞–∑–∞ –∏ —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏.

–í —Å–∏—Å—Ç–µ–º–µ **Faceplate** –¥—Ä–∞–π–≤–µ—Ä M-Bus —è–≤–ª—è–µ—Ç—Å—è –≥–∏–±—Ä–∏–¥–Ω—ã–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —É—Ä–æ–≤–Ω—è:
1.  **Serial (COM):** –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ Master-–∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä —É—Ä–æ–≤–Ω–µ–π (M-Bus <-> RS-232/485).
2.  **TCP (Ethernet):** –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —É–¥–∞–ª–µ–Ω–Ω—ã–µ —à–ª—é–∑—ã (Ethernet-to-MBus) –∏–ª–∏ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —à–∞–≥–æ–≤:
1.  **Connection (`plc_mbus_connection`):** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –¥–æ —à–∏–Ω—ã.
2.  **Binding (`plc_mbus_binding`):** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–ø—Ä–æ—Å–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–±–æ—Ä–∞.

---

## –®–ê–ì 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (Connection)

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –º—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º –º–∞—Å—Ç–µ—Ä-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –æ–ø—Ä–∞—à–∏–≤–∞—é—â–µ–µ —à–∏–Ω—É.

### 1.1 –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (Runtime)
*–ü–∞–Ω–µ–ª—å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥—Ä–∞–π–≤–µ—Ä–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.*

![–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ M-Bus](images/mbus3.png)

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| **State** | **STOP** (–ö—Ä–∞—Å–Ω—ã–π) ‚Äî –æ–ø—Ä–æ—Å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.<br>**RUN** (–ó–µ–ª–µ–Ω—ã–π) ‚Äî –¥—Ä–∞–π–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç. |
| **Error** | –¢–µ–∫—Å—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Timeout` –∏–ª–∏ `Checksum error`). |
| **Actual connection** | –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–æ–π –∫–∞–Ω–∞–ª –∞–∫—Ç–∏–≤–µ–Ω (Master –∏–ª–∏ Backup). |

### 1.2 –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (General Settings)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ |
| :--- | :--- |
| **Name** | –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ. |
| **Period (ms)** | –ü–µ—Ä–∏–æ–¥ –æ–ø—Ä–æ—Å–∞ —à–∏–Ω—ã. <br>‚ö†Ô∏è **–í–∞–∂–Ω–æ:** M-Bus ‚Äî –º–µ–¥–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª (–æ–±—ã—á–Ω–æ 2400 –±–æ–¥). –ù–µ —Å—Ç–∞–≤—å—Ç–µ –ø–µ—Ä–∏–æ–¥ –º–µ–Ω–µ–µ **60000 –º—Å** (1 –º–∏–Ω—É—Ç–∞), –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –ø—Ä–∏–±–æ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –æ—Ç –±–∞—Ç–∞—Ä–µ–µ–∫, —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑—Ä—è–¥–∏—Ç—å –∏—Ö —Ä–∞–Ω—å—à–µ —Å—Ä–æ–∫–∞. |
| **Type** | –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞: `serial` –∏–ª–∏ `tcp`. |

---

### 1.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è (–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç Type)

#### –í–∞—Ä–∏–∞–Ω—Ç –ê: –†–µ–∂–∏–º `serial` (–ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–π –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä M-Bus –ø–æ–¥–∫–ª—é—á–µ–Ω –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –∫ COM-–ø–æ—Ä—Ç—É —Å–µ—Ä–≤–µ—Ä–∞.

![–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Serial M-Bus](images/mbus2.png)

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| **Port** | –°–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è –ø–æ—Ä—Ç–∞ (Linux: `/dev/ttyUSB0`, Win: `COM1`). |
| **Baud rate** | –°–∫–æ—Ä–æ—Å—Ç—å –æ–±–º–µ–Ω–∞. <br>*–°—Ç–∞–Ω–¥–∞—Ä—Ç:* –û–±—ã—á–Ω–æ **2400** (—Ä–µ–∂–µ 9600). –î–æ–ª–∂–Ω–∞ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø—Ä–∏–±–æ—Ä–æ–≤. |
| **Parity** | –ß–µ—Ç–Ω–æ—Å—Ç—å. <br>*–°—Ç–∞–Ω–¥–∞—Ä—Ç:* –û–±—ã—á–Ω–æ **Even** (–ß–µ—Ç–Ω–æ—Å—Ç—å). –ù–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ —Å—Ç–æ–∏—Ç `no`, –Ω–æ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Ç–µ–ø–ª–æ—Å—á–µ—Ç—á–∏–∫–æ–≤ —Ç—Ä–µ–±—É–µ—Ç—Å—è `Even`. |
| **Data / Stop bits** | –û–±—ã—á–Ω–æ 8 –±–∏—Ç –¥–∞–Ω–Ω—ã—Ö –∏ 1 —Å—Ç–æ–ø-–±–∏—Ç. |
| **Timeout** | –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞. –î–ª—è M-Bus –ª—É—á—à–µ —Å—Ç–∞–≤–∏—Ç—å —Å –∑–∞–ø–∞—Å–æ–º (3000-5000 –º—Å). |

#### –í–∞—Ä–∏–∞–Ω—Ç –ë: –†–µ–∂–∏–º `tcp` (–°–µ—Ç–µ–≤–æ–π —à–ª—é–∑)
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ —à–∏–Ω–∞ M-Bus –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —É–¥–∞–ª–µ–Ω–Ω–æ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ —á–µ—Ä–µ–∑ Ethernet-–∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä.

![–ù–∞—Å—Ç—Ä–æ–π–∫–∞ TCP M-Bus](images/mbus1.png)

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| **IP/Hostname** | IP-–∞–¥—Ä–µ—Å —à–ª—é–∑–∞. |
| **Port** | TCP –ø–æ—Ä—Ç (—á–∞—Å—Ç–æ `502`, `1001` –∏–ª–∏ `8000` ‚Äî —Å–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –Ω–∞ —à–ª—é–∑). |
| **Timeout** | –£—á–∏—Ç—ã–≤–∞–π—Ç–µ —Å–µ—Ç–µ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ + –º–µ–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∞–º–æ–π —à–∏–Ω—ã. |

> **–î–µ–π—Å—Ç–≤–∏–µ:** –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞–∂–º–∏—Ç–µ **Save**, –∑–∞—Ç–µ–º –¥–≤–∞–∂–¥—ã –∫–ª–∏–∫–Ω–∏—Ç–µ –ø–æ —Å–æ–∑–¥–∞–Ω–Ω–æ–º—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—é, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—è–∑–∫–∏.

---

## –®–ê–ì 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (Binding)

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å M-Bus –≤ —Ç–æ–º, —á—Ç–æ –ø—Ä–∏–±–æ—Ä –æ—Ç–¥–∞–µ—Ç **–≤—Å—é** –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–¥–Ω–∏–º –±–æ–ª—å—à–∏–º –ø–∞–∫–µ—Ç–æ–º. –ó–∞–¥–∞—á–∞ Binding ‚Äî "–≤—ã–∫—É—Å–∏—Ç—å" –∏–∑ —ç—Ç–æ–≥–æ –ø–∞–∫–µ—Ç–∞ –Ω—É–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

![–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π M-Bus](images/mbus4.png)

### 2.1 –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏–≤—è–∑–∫–∏

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| **Name** | –ò–º—è –æ–±—ä–µ–∫—Ç–∞ –ø—Ä–∏–≤—è–∑–∫–∏. |
| **Tag** | –°–∏—Å—Ç–µ–º–Ω—ã–π —Ç–µ–≥, –≤ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ. |
| **Access** | **R** ‚Äî Read Only (–¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ).<br>**W** ‚Äî Write (–†–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ M-Bus). |
| **Address** | **Primary Address (–ü–µ—Ä–≤–∏—á–Ω—ã–π –∞–¥—Ä–µ—Å).** –ß–∏—Å–ª–æ –æ—Ç 1 –¥–æ 250. –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å —Å—á–µ—Ç—á–∏–∫–∞ –Ω–∞ —à–∏–Ω–µ. |
| **Telegram** | –ù–æ–º–µ—Ä —Ç–µ–ª–µ–≥—Ä–∞–º–º—ã. –î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–æ—Å—Ç—ã—Ö –ø—Ä–∏–±–æ—Ä–æ–≤ = `0`. (–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≤–ª–µ–∑–∞—é—Ç –≤ –æ–¥–∏–Ω –ø–∞–∫–µ—Ç). |
| **Index** | **–ò–Ω–¥–µ–∫—Å –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–∫–µ—Ç–µ.** –°–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä. <br>–≠—Ç–æ –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –æ—Ç–≤–µ—Ç–∞ M-Bus. <br>*–ü—Ä–∏–º–µ—Ä:* –ï—Å–ª–∏ —Å—á–µ—Ç—á–∏–∫ —à–ª–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: [–í—Ä–µ–º—è, –≠–Ω–µ—Ä–≥–∏—è, –†–∞—Å—Ö–æ–¥, –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞], —Ç–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≠–Ω–µ—Ä–≥–∏–∏ Index = `1` (–∏–ª–∏ `0`, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥—Ä–∞–π–≤–µ—Ä–∞, –Ω–∞—á–Ω–∏—Ç–µ —Å 0). |

---

## üí° –°–æ–≤–µ—Ç—ã –ø–æ –Ω–∞–ª–∞–¥–∫–µ (Troubleshooting)

1.  **–§–∏–∑–∏–∫–∞ —Å–≤—è–∑–∏ (90% –ø—Ä–æ–±–ª–µ–º):**
    * –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å—á–µ—Ç—á–∏–∫–æ–≤ (Danfoss, Kamstrup, Techem): **2400 baud, 8E1 (Even Parity)**.
    * –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Å–µ–∫—Ü–∏–∏ `Serial` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —ç—Ç–æ–º—É —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É. –ù–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞—Ö `9600 8N1` ‚Äî —ç—Ç–æ —á–∞—Å—Ç–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è Modbus, –Ω–æ —Ä–µ–¥–∫–æ –¥–ª—è M-Bus.
2.  **–ü–æ–∏—Å–∫ –ò–Ω–¥–µ–∫—Å–∞ (Index):**
    * –î—Ä–∞–π–≤–µ—Ä –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑ –ø–∞–∫–µ—Ç–∞ ("Energy", "Volume"), –æ–Ω –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö.
    * *–°–æ–≤–µ—Ç:* –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–æ—Ä–æ–Ω–Ω—é—é —É—Ç–∏–ª–∏—Ç—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, M-Bus Sheet –∏–ª–∏ –ü–û –æ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è —à–ª—é–∑–∞), —á—Ç–æ–±—ã –ø—Ä–æ—á–∏—Ç–∞—Ç—å –ø–∞–∫–µ—Ç —Ü–µ–ª–∏–∫–æ–º, –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –∫–∞–∫–∏–º –ø–æ —Å—á–µ—Ç—É –∏–¥–µ—Ç –Ω—É–∂–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä, –∏ –≤–ø–∏—Å–∞—Ç—å —ç—Ç–æ—Ç –Ω–æ–º–µ—Ä –≤ –ø–æ–ª–µ `Index`.
3.  **–ö–æ–ª–ª–∏–∑–∏–∏ –∞–¥—Ä–µ—Å–æ–≤:**
    * –í M-Bus —á–∞—Å—Ç–∞—è –ø—Ä–æ–±–ª–µ–º–∞ ‚Äî –¥–≤–∞ –ø—Ä–∏–±–æ—Ä–∞ —Å –∑–∞–≤–æ–¥—Å–∫–∏–º –∞–¥—Ä–µ—Å–æ–º `0` –∏–ª–∏ `1` –Ω–∞ –æ–¥–Ω–æ–π —à–∏–Ω–µ. –ü–æ–¥–∫–ª—é—á–∞–π—Ç–µ –ø—Ä–∏–±–æ—Ä—ã –ø–æ –æ–¥–Ω–æ–º—É –∏ –º–µ–Ω—è–π—Ç–µ –∏–º –∞–¥—Ä–µ—Å–∞ –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π –ø–æ–ª–Ω–æ–π —à–∏–Ω—ã.