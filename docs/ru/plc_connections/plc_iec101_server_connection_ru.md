# Руководство по конфигурации IEC 60870-5-101 Server

## Общее описание
Драйвер **IEC 101 Server** позволяет системе **Faceplate** работать в режиме Контролируемого Пункта (КП / Slave) по последовательным интерфейсам (RS-232/485). В этом режиме система ожидает запросов от внешнего Пункта Управления (Master), передает данные и выполняет команды телеуправления.

Процесс настройки состоит из двух этапов:
1.  **Connection (`plc_iec101_server_connection`):** Настройка COM-порта, физического уровня и параметров адресации.
2.  **Binding (`plc_iec101_server_binding`):** Формирование карты адресов (IOA) и настройка параметров управления.

---

## ШАГ 1. Настройка соединения (Connection)

На этом этапе задаются параметры порта и логики протокола. Они должны строго соответствовать настройкам Мастера.

![Настройка соединения IEC 101 Server](images/plc_iec101_server_conn.png)

### 1.1 Панель диагностики (Runtime)
| Поле | Описание |
| :--- | :--- |
| **State** | **STOP** — сервер остановлен.<br>**RUN** — сервер запущен, порт открыт. |
| **Error** | Текст ошибки (например, невозможность открыть COM-порт). |
| **Actual connection** | Текущий активный канал (при резервировании). |

### 1.2 Основные параметры (Settings)
| Параметр | Описание |
| :--- | :--- |
| **Name** | Уникальное имя соединения. |
| **Period (ms)** | Внутренний цикл обработки событий. |
| **Shutdown timeout (ms)** | Время ожидания при остановке драйвера. |
| **Support for group requests** | **Yes** — отвечать на команды общего опроса (General Interrogation). |
| **Max. package length** | Максимальный размер пакета (обычно 250). |
| **Line Delay Ratio** | Коэффициент задержки ответа (для медленных линий). |

### 1.3 Параметры Протокола и Адресации
| Поле | Описание |
| :--- | :--- |
| **Common Address of ASDU** | **Адрес станции (CA).** Логический адрес этого устройства. |
| **Common Address Size** | Размер поля адреса ASDU (1 или 2 байта). |
| **Originator Address Size** | Размер поля адреса отправителя (1 байт или 0). |
| **Information Object Address Size** | Размер поля IOA (2 или 3 байта). |
| **Link Address** | **Адрес канального уровня.** Используется в несбалансированном режиме для адресации на шине. |
| **Link Address Size** | Размер поля адреса канала (1 или 2 байта). |
| **Balanced** | **Режим передачи:**<br>• **Off (Unbalanced):** Несбалансированный (Master-Slave). Обычный режим для RS-485.<br>• **On (Balanced):** Сбалансированный (Point-to-Point). Равноправный режим (обычно RS-232). |

### 1.4 Настройки порта (SERIAL)
| Поле | Описание |
| :--- | :--- |
| **Port** | Имя порта (например, `/dev/ttyUSB0` или `COM1`). |
| **Baud rate** | Скорость передачи (9600, 19200 и т.д.). |
| **Parity** | Четность. В IEC 101 стандартом де-факто является **Even** (Четность). |
| **Stop bits** | Стоповые биты. |
| **Data bits** | Биты данных (обычно 8). |
| **Timeout** | Время ожидания байта в линии. |
| **Attempts** | Количество повторов (актуально для балансного режима). |

**Group broadcast:** Настройка периодической спорадической отправки данных определенных групп без запроса Мастера.
**Принимать обновления через информационные объекты:** Разрешить изменение внутренних тегов при записи в IOA (режим шлюза).

---

## ШАГ 2. Настройка переменных (Binding)

Определение списка сигналов для передачи Мастеру.

![Настройка привязки IEC 101 Server](images/plc_iec101_server_binding.png)

### 2.1 Параметры привязки
| Поле | Описание |
| :--- | :--- |
| **Name** | Имя привязки. |
| **Tag** | Внутренний тег Faceplate. |
| **Access** | **R** (Мониторинг), **RW** (Мониторинг + Управление). |
| **Address** | **IOA (Information Object Address).** Адрес объекта. |
| **Type** | **Тип ASDU.** Формат данных для отправки (например, `M_SP_NA_1`). |
| **Parameter** | Атрибут тега (`Value`, `Quality`, `Timestamp`). |

### 2.2 Параметры Телеуправления (Remote Control)
Поля активны при `Access = RW`.

| Поле | Описание |
| :--- | :--- |
| **Remote control type** | Тип команды, ожидаемой от Мастера (например, `C_SC_NA_1`). |
| **Remote control address** | IOA для команды управления. |
| **Group** | Группа опроса (обычно 20). |