# Руководство по конфигурации OPC DA (Classic)

## Общее описание
**OPC DA (Data Access)** — это классический стандарт обмена данными в промышленной автоматизации, основанный на технологии Microsoft DCOM. В системе **Faceplate** данный драйвер позволяет подключаться к любым внешним OPC-серверам (например, Kepware, Matrikon, Lectus) и считывать с них данные.

> **Важно:** Поскольку OPC DA базируется на DCOM, для успешного соединения часто требуется настройка прав доступа Windows и DCOM на обеих сторонах (Клиент и Сервер).

Процесс настройки состоит из двух этапов:
1.  **Connection (`plc_opcda_connection`):** Настройка подключения к OPC-серверу.
2.  **Binding (`plc_opcda_binding`):** Подписка на конкретные теги.

---

## ШАГ 1. Настройка соединения (Connection)

На этом этапе мы указываем, где находится OPC-сервер и как он называется.

### 1.1 Панель диагностики (Runtime)
*Верхняя часть окна. Отображает статус подключения.*

| Поле | Описание |
| :--- | :--- |
| **State** | **STOP** (Красный) — драйвер остановлен.<br>**RUN** (Зеленый) — соединение с сервером установлено. |
| **Error** | Текст ошибки. Частые ошибки: `Access Denied` (проблемы DCOM) или `Server not found`. |
| **Actual connection** | Текущий активный канал (при использовании резервирования). |

### 1.2 Параметры конфигурации (Settings)

![Настройка OPC DA Connection](images/opcda_conn.png)

#### Основные параметры
| Параметр | Описание |
| :--- | :--- |
| **Name** | Уникальное имя соединения. |
| **Period (ms)** | Период обновления данных (Update Rate для группы OPC). |
| **Shutdown timeout** | Время ожидания корректного отключения от сервера. |
| **Master connection** | Ссылка на основное соединение (для настройки резервирования). |
| **Support for group requests** | **Yes** — использовать механизм OPC Group для пакетного чтения (рекомендуется). |

#### Параметры подключения (TCP / DCOM)
В отличие от других драйверов, здесь настройки сети указывают на хост, где запущен OPC Server.

| Поле | Описание |
| :--- | :--- |
| **IP/Hostname/Localhost** | Сетевой адрес компьютера, где установлен OPC-сервер.<br>*Пример:* `192.168.1.5` или `localhost` (если сервер на той же машине). |
| **Port** | **8100** (или другой порт, если используется туннелирование). <br>*Примечание:* В классическом OPC DA порт TCP жестко не задается (работает через DCOM/RPC, порт 135), но в данном драйвере это поле может использоваться для специфичных OPC-туннелей или внутренних прокси. |
| **ServerID** | **ProgID OPC-сервера.** Это самое важное поле.<br>Оно точно идентифицирует программный компонент сервера в реестре Windows.<br>*Примеры:* `Kepware.KEPServerEX.V6`, `Matrikon.OPC.Simulation.1`, `ICONICS.SimulatorOPCDA.2`. |

---

## ШАГ 2. Настройка переменных (Binding)

В OPC DA адресация происходит по имени тега (Item ID).

![Настройка OPC DA Binding](images/)

### 2.1 Параметры привязки

| Поле | Описание |
| :--- | :--- |
| **Name** | Имя привязки в дереве проекта. |
| **Title** | Человекочитаемое описание. |
| **Tag** | Внутренний системный тег Faceplate, куда будет транслироваться значение. |
| **Access** | **R** — Чтение (Read), **W** — Запись (Write), **RW** — Чтение и запись. |
| **Transformation** | *Опционально.* Математическая обработка сырого значения. |

### 2.2 Адресация (OPC Tag)

| Поле | Инструкция |
| :--- | :--- |
| **OPC tag** | **Item ID (Идентификатор элемента).**<br>Полный путь к тегу в адресном пространстве OPC-сервера.<br>*Примеры:*<br>• `Channel1.Device1.Tag1`<br>• `Simulation.Ramp`<br>• `Bucket Brigade.Int4` |

---

<!-- ## Дополнительно

1.  **ProgID (ServerID):** Убедитесь, что имя сервера введено без ошибок. Если сервер установлен локально, список доступных ProgID можно посмотреть утилитами типа *OPC Explorer* или *Matrikon OPC Explorer*.
2.  **DCOM Hell:** Если `IP` удаленный, а статус соединения `Error`, в 99% случаев проблема в правах Windows.
    * Создайте на обеих машинах пользователя с одинаковым логином и паролем.
    * Запустите службы Faceplate от имени этого пользователя.
    * Настройте DCOM Config (`dcomcnfg`) на сервере, разрешив удаленный доступ.
3.  **Синтаксис тегов:** Item ID чувствителен к регистру (зависит от сервера). Скопируйте путь к тегу из OPC-клиента, чтобы исключить опечатки.
4.  **Качество (Quality):** Если связь есть (`State: RUN`), но значение тега "плохое" или `0`, проверьте качество тега на самом OPC-сервере. Возможно, сервер не видит ПЛК. -->