# Интеграция Faceplate с InfluxDB (HTTPS)

Интеграция системы Faceplate с базой временных рядов InfluxDB через HTTPS обеспечивает защищённую и надёжную передачу телеметрии. Ниже — шаблон технического описания и примеры конфигурации.

## 1. Архитектура решения

Решение использует встроенные механизмы Faceplate для работы с внешними API. Передача данных осуществляется методом POST на эндпоинт InfluxDB API (v2.x).

Основные компоненты:
- Faceplate — HTTP-клиент, собирающий и отправляющий данные.
- HTTPS (TLS) — шифрование канала передачи.
- InfluxDB API v2 — приём данных в формате Line Protocol.
- API Token — аутентификация запросов.

## 2. Формат данных (Line Protocol)

Для записи в InfluxDB данные должны быть в формате Line Protocol:

measurement,tag_key=tag_value field_key=field_value timestamp

Пример строки:
telemetry,device=sensor_01 temperature=22.5,pressure=1013 1673785630000000000

Примечания:
- measurement — имя измерения.
- tag — индексируемое поле (строка).
- field — значение (число, строка или булево).
- timestamp — в наносекундах (опционально; если отсутствует, InfluxDB присвоит текущий).

## 3. Параметры подключения

Для формирования запроса из Faceplate потребуются следующие параметры:

| Параметр | Описание | Пример |
|---|---:|---|
| URL | Адрес сервера InfluxDB | https://influx-server.com:8086 |
| Org | Название организации | my_company |
| Bucket | Имя целевого bucket | telemetry_bucket |
| Token | API токен доступа | MySecretToken |

Пример конечной точки записи:
https://influx-server.com:8086/api/v2/write?org=my_company&bucket=telemetry_bucket&precision=ns

Заголовки:
- Authorization: Token YOUR_API_TOKEN
- Content-Type: text/plain; charset=utf-8
- Accept: application/json

## 4. Пример реализации с  использованием плагина InfluxDB



Рекомендация: отправлять данные пачками (batch writing) — по 500–1000 строк в одном запросе для оптимальной производительности.

## 5. Безопасность и отказоустойчивость

- Проверка сертификатов: убедитесь, что на сервере Faceplate установлены корневые CA для проверки SSL-сертификата InfluxDB.
- Буферизация: при потере связи реализуйте локальный буфер (очередь) для сохранения точек до восстановления соединения.
- Повторная отправка: используйте экспоненциальный бэкофф и ограничение числа попыток.
- Логи и мониторинг: логируйте неудачные попытки и состояние очереди.

## 6. Пример структуры документации проекта

Документ: Спецификация обмена данными Faceplate → InfluxDB  
Версия: 1.0  
Объект: Насосная станция №1

Перечень передаваемых сигналов:
- AI_Temperature → Field: temp, Measurement: pump_stats
- AI_Pressure → Field: press, Measurement: pump_stats
- DI_Status → Field: state, Tag: status

Дополнения: форматы значений, частота отправки, требования к точности timestamp, требования к ретеншну в InfluxDB.